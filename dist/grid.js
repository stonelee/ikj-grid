define("kjui/grid/1.3.0/loading",["$","arale/widget/1.0.4/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.4/templatable","gallery/handlebars/1.0.1/handlebars"],function(e,t,n){var r=e("$"),i=e("arale/widget/1.0.4/widget"),s=e("arale/widget/1.0.4/templatable"),o=i.extend({Implements:s,template:'<div class="mask"> <div class="mask-bg"></div> <div class="mask-msg" style="left:{{left}}px;top:{{top}}px;"> <div class="loading">{{content}}</div> </div> </div>',model:{left:0,top:0,content:"加载中..."}});n.exports=o}),define("kjui/grid/1.3.0/grid",["./loading","$","arale/widget/1.0.4/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events","arale/widget/1.0.4/templatable","gallery/handlebars/1.0.1/handlebars","gallery/underscore/1.4.2/underscore"],function(e,t,n){var r=e("$"),i=e("arale/widget/1.0.4/widget"),s=e("arale/widget/1.0.4/templatable"),o=e("gallery/handlebars/1.0.1/handlebars"),u=e("gallery/underscore/1.4.2/underscore"),a=e("./loading"),f=i.extend({Implements:s,attrs:{url:"",urlParser:null,data:[]},template:'<div class="panel-mod" style="width:{{width}}px;"> {{#if title}} <div class="panel-hd"> <span>{{title}}</span> </div> {{/if}} <div class="panel-bd"><div class="grid-hd"> <table> <thead> <tr> {{#if needCheckbox}} <th style="width:{{checkboxWidth}}px;"></th> {{/if}} {{#if needOrder}} <th style="width:{{orderWidth}}px;"></th> {{/if}} {{#each fields}} <th style="width:{{width}}px;"></th> {{/each}} <th style="width:18px;"></th> <th></th> </tr> </thead> <tbody> {{createHeader headers}} </tbody> </table> </div><div class="grid-bd" style="height:{{height}}px;"> <div class="grid-view"{{#unless isLong}} style="_overflow-x:hidden;"{{/unless}}> <table> <thead> <tr> {{#if needCheckbox}} <th style="width:{{checkboxWidth}}px;"></th> {{/if}} {{#if needOrder}} <th style="width:{{orderWidth}}px;"></th> {{/if}} {{#each fields}} <th style="width:{{width}}px;"></th> {{/each}} <th></th> </tr> </thead> <tbody></tbody> </table> </div> </div>{{#if paginate}} <div class="toolbar-ft"> <span class="toolbar-text-right">共{{totalCount}}条记录，每页{{pageSize}}条</span> <i class="{{#if isFirst}}icon-grid-page-first-disabled{{else}}icon-grid-page-first{{/if}}" data-role="first"></i> <i class="{{#if hasPrev}}icon-grid-page-prev{{else}}icon-grid-page-prev-disabled{{/if}}" data-role="prev"></i> <i class="toolbar-separator"></i> <span class="toolbar-text">当前第</span> <input style="width:40px;" type="text" data-role="num"> <span class="toolbar-text">/{{pageNumbers}}页</span> <i class="toolbar-separator"></i> <i class="{{#if hasNext}}icon-grid-page-next{{else}}icon-grid-page-next-disabled{{/if}}" data-role="next"></i> <i class="{{#if isLast}}icon-grid-page-last-disabled{{else}}icon-grid-page-last{{/if}}" data-role="last"></i> <i class="toolbar-separator"></i> <i class="icon-grid-refresh" data-role="refresh"></i> </div> {{/if}} </div> </div>',model:{fields:[],title:"",paginate:!0,needCheckbox:!1,checkboxWidth:30,needOrder:!1,orderWidth:30,width:null,height:null},parseElement:function(){u.defaults(this.model,{width:r(this.get("parentNode")).innerWidth(),records:[],isFirst:!0,isLast:!0,hasPrev:!1,hasNext:!1,totalCount:0,pageSize:0,pageNumbers:0}),this.model.headers=this._processHeaders(),this.model.fields=this._processFields(),f.superclass.parseElement.call(this)},_processHeaders:function(){function t(n,i){e.length<i+1?e.push(n):e[i]=e[i].concat(n);var s=i+1;r.each(n,function(){this.children&&this.children.length>0&&t(this.children,s)})}function n(e,t){var r=t+e.length;for(var i=0;i<e.length;i++){var s=e[i];s.children&&s.children.length>0&&(r=n(s.children,r-1))}return r}var e=[];t(this.model.fields,0);var i=e.length;for(var s=0;s<i;s++){var o=e[s];for(var u=0;u<o.length;u++){var a=o[u];if(a.children&&a.children.length>0){var f=0;f=n(a.children,f),a.colspan=f}else i>1&&(a.rowspan=i-s),a.rowspan==1&&delete a.rowspan}}return e},_processFields:function(){function i(s){r.each(s,function(){this.children&&this.children.length>0?i(this.children):(n.push(this),this.width&&(e+=this.width,t+=1))})}var e=0,t=0,n=[];i(this.model.fields);var s=18;t===n.length&&e>this.model.width&&(this.model.isLong=!0,s=0);var o=this.model.width-e-s;this.model.needCheckbox&&(o-=this.model.checkboxWidth),this.model.needOrder&&(o-=this.model.orderWidth);var u=o/(n.length-t);for(var a=n.length-1;a>=0;a--)n[a].width||(n[a].width=u);return n},templateHelpers:{createHeader:function(e){var t=r.extend({},this,{needRowspan:this.headers.length>1,rowspan:this.headers.length}),n=o.compile('{{#if needCheckbox}} <td class="grid-cell" width="{{checkboxWidth}}"{{#if needRowspan}} rowspan="{{rowspan}}"{{/if}}> <input type="checkbox" data-role="checkAll"/> </td> {{/if}} {{#if needOrder}} <td class="grid-cell" width="{{orderWidth}}"{{#if needRowspan}} rowspan="{{rowspan}}"{{/if}}></td> {{/if}}')(t),i="<tr>"+n,s='{{#each headers}} <td class="grid-cell{{addSortClass sort}}" {{#if name}} data-name="{{name}}"{{/if}} {{#if sort}} data-sortable{{/if}} {{#if rowspan}} rowspan="{{rowspan}}"{{/if}} {{#if colspan}} colspan="{{colspan}}"{{/if}} ><span>{{header}}</span> </td> {{/each}}';o.registerHelper("addSortClass",function(e){if(e=="asc"||e=="desc")return new o.SafeString(" grid-is-"+e)});var u=o.compile(s)({headers:this.headers[0]});i+=u+"</tr>";for(var a=1;a<this.headers.length;a++)i+="<tr>",u=o.compile(s)({headers:this.headers[a]}),i+=u+"</tr>";return new o.SafeString(i)}},setup:function(){var e=this;this.model.isLong&&this.$(".grid-view").scroll(function(){e.$(".grid-hd").scrollLeft(r(this).scrollLeft())})},_onRenderUrl:function(e){var t=this;this.showLoading(),r.getJSON(e,function(e){t._loadData(e.data),t.hideLoading()})},_onRenderData:function(e){this._loadData(e)},_loadData:function(e){var t=this;this.data=e;var n=r.map(e.result,function(n,i){var s="";return t.model.needOrder&&(s=(e.pageNumber-1)*e.pageSize+i+1),{isAlt:i%2===1,order:s,values:r.map(t.model.fields,function(e){var t=n[e.name];t=u.escape(t),r.isFunction(e.render)&&(t=e.render(t));var i=u.clone(e);return i.value=t,i})}}),i=o.compile('{{#each records}} <tr class="grid-row{{#if isAlt}} grid-row-alt{{/if}}"> {{#if ../needCheckbox}} <td class="grid-cell grid-mark-cell"> <input type="checkbox" data-role="check"/> </td> {{/if}} {{#if ../needOrder}} <td class="grid-cell grid-mark-cell"> {{order}} </td> {{/if}} {{#each values}} <td class="grid-cell"{{#if align}} style="text-align:{{align}};"{{/if}}> {{{value}}} </td> {{/each}} </tr> {{/each}}')(r.extend({},this.model,{records:n}));this.$(".grid-view tbody").html(i),r.extend(this.model,{isFirst:function(){return e.pageNumber<=1},isLast:function(){return e.totalPages===0||e.pageNumber===e.totalPages},hasPrev:e.hasPrev,hasNext:e.hasNext,totalCount:e.totalCount,pageSize:e.pageSize,pageNumbers:function(){return Math.ceil(e.totalCount/e.pageSize)}}),this.renderPartial(".toolbar-ft");var s=this.$(".grid-row");r.each(e.result,function(e,t){s.eq(e).data("data",t)}),this.model.needCheckbox?this.selected=[]:this.selected=null;var a=this.$("[data-role=checkAll]");a.length>0&&(a[0].indeterminate=!1,a.prop("checked",!1)),this.$("[data-role=num]").val(e.pageNumber),this.$("i").click(function(e){/disabled/.test(e.target.className)&&e.stopImmediatePropagation()}),this.trigger("loaded")},events:{"click .grid-hd":"_sort","click .grid-row":"_click","click [data-role=check]":"_check","click [data-role=checkAll]":"_checkAll","click [data-role=prev]":"prevPage","click [data-role=next]":"nextPage","click [data-role=first]":"firstPage","click [data-role=last]":"lastPage","click [data-role=refresh]":"refresh","keyup [data-role=num]":"_gotoPage"},_sort:function(e){var t=r(e.target).closest("td");if(!t[0].hasAttribute("data-sortable"))return;var n=t.attr("data-name");this._oldSortHeader?this._oldSortHeader.attr("data-name")!==n&&(this._oldSortHeader.removeClass("grid-is-desc grid-is-asc"),this._oldSortHeader=t):this._oldSortHeader=t,t.hasClass("grid-is-desc")?(t.removeClass("grid-is-desc").addClass("grid-is-asc"),this.trigger("sort",n,"asc")):(t.removeClass("grid-is-asc").addClass("grid-is-desc"),this.trigger("sort",n,"desc"))},_click:function(e){var t=r(e.target),n=t.parents("tr"),i=n.data("data");this.model.needCheckbox||(this.selected&&this.selected.data("data").id===i.id?(this.selected=null,n.removeClass("grid-row-is-selected")):(this.selected=n,n.addClass("grid-row-is-selected").siblings().removeClass("grid-row-is-selected"))),t.attr("data-role")!="check"&&this.trigger("click",t,i)},_check:function(e){var t=r(e.target),n=t.parents("tr"),i=r("[data-role=checkAll]");i[0].indeterminate=!0;if(t.prop("checked"))this.selected.push(n),n.addClass("grid-row-is-selected"),r("[data-role=check]").not(":checked").length===0&&(i[0].indeterminate=!1,i.prop("checked",!0));else{var s=n.data("data").id;for(var o=this.selected.length-1;o>=0;o--)this.selected[o].data("data").id===s&&this.selected.splice(o,1);n.removeClass("grid-row-is-selected"),r("[data-role=check]").is(":checked")||(i[0].indeterminate=!1,i.prop("checked",!1))}},_checkAll:function(e){var t=r(e.target),n=this.$("[data-role=check]"),i=n.parents("tr");if(t.prop("checked")){var s=[];i.each(function(e,t){s.push(r(t))}),this.selected=s,n.prop("checked",!0),i.addClass("grid-row-is-selected")}else this.selected=[],n.prop("checked",!1),i.removeClass("grid-row-is-selected")},_gotoPage:function(e){var t=r(e.target),n=t.val();if(n&&e.which==13)this.gotoPage(n);else{n=n.replace(/\D/g,"");if(n){n=parseInt(n,10);var i=this.data.totalPages;n>i?n=i:n===0&&(n=1),t.val(n)}else t.val("")}},gotoPage:function(e){var t=this.get("urlParser"),n=this.get("url").replace(t,"$1"+e+"$2");this.set("url",n)},prevPage:function(){var e=this.data.prevPage;this.gotoPage(e)},nextPage:function(){var e=this.data.nextPage;this.gotoPage(e)},firstPage:function(){var e=this.data.firstPage;this.gotoPage(e)},lastPage:function(){var e=this.data.lastPage;this.gotoPage(e)},refresh:function(){var e=this.get("url");this._onRenderUrl(e)},showLoading:function(){this.loading?this.loading.element.show():this.loading=(new a({parentNode:this.$(".grid-bd"),model:{left:(this.model.width-106)/2,top:(this.model.height-36)/2}})).render()},hideLoading:function(){this.loading.element.hide()}});n.exports=f});